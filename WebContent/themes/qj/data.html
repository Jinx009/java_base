<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>数据曲线</title>
<link
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	rel="stylesheet">
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
					aria-expanded="false">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" target="_blank"
					href="http://www.zhanway.com"><img height="50px;"
					style="margin-top: -15px;" src="img/logo.png"></a>
			</div>
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="show.html">地理位置</a></li>
					<li><a href="logs.html">倾角数据</a></li>
					<li class="active"><a href="data.html">数据曲线</a></li>
					<li><a href="notice.html">通知管理</a></li>
					<li><a href="lfj.html">裂缝计</a></li>
					<li><a href="ylj.html">雨量计</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a target="_blank" href="http://www.zhanway.com">走进展为</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="row" style="width: 98%; margin-left: 1%;">
		<div class="col-md-12">
			<div class="panel panel-default">
				<div class="panel-heading">基本信息</div>
				<div class="input-group"
					style="padding-left: 15px; width: 220px; padding-bottom: 15px; margin-top: 10px; float: left;">
					<input type="text" class="form-control" id="mac"
						placeholder="请输入mac号码" value="0009190600000001">
				</div>
				<div class="input-group"
					style="padding-left: 15px; width: 220px; padding-bottom: 15px; margin-top: 10px; float: left;">
					<input type="text" class="form-control" id="tem"
						placeholder="请输入温度区间格式：8-21" value="">
				</div>
				<div class="input-group"
					style="padding-left: 15px; width: 220px; padding-bottom: 15px; margin-top: 10px; float: left;">
					<select class="form-control" id="type">
						<option value="0">全部数据</option>
						<option value="1">只看心跳</option>
						<option value="2">只看报警</option>
					</select>
				</div>
				<div class="input-group"
					style="padding-left: 15px; width: 220px; padding-bottom: 15px; margin-top: 10px; float: left;">
					<input type="text" class="form-control" readonly="readonly"
						id="datepicker"> <span class="input-group-btn">
						<button class="btn btn-default" onclick="_getData();"
							type="button">&nbsp;查&nbsp;看&nbsp;</button>
					</span>
				</div>
			</div>
			<div id="logs"></div>
		</div>
	</div>
	<div class="row" style="width: 98%; margin-left: 1%;">
		<div class="col-md-12" id="data">
			<div class="panel panel-default" style="border-color: white;">
				<div class="panel-body">
					<div
						style="float: left; position: relative; min-height: 1px; width: 1280px; height: 500px; padding: 0"
						id="draw_1"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- 	<footer class="main-footer"
		style="text-align: center; width: 100%; position: absolute; bottom: 15px;">
		<strong>Copyright &copy; <a href="http://www.zhanway.com"
			target="_blank">上海展为智能技术股份有限公司</a>.
		</strong> All rights reserved.
	</footer> -->
	<div class="control-sidebar-bg"></div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.12.0/jquery.min.js"></script>
<script
	src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.4.4/vue.min.js"></script>
<script src="/themes/layer/layer.js"></script>
<script src="/themes/laydate/laydate.js"></script>
<script src="js/base.js"></script>
<script src="https://cdn.bootcss.com/echarts/3.8.0/echarts.min.js"></script>
<script type="text/javascript">
var acc_x = [],acc_y = [],acc_z =[],x=[],y=[],z=[],ddate =[],tem=[];
	$(function() {
	//	$('#datepicker').val(new Date().Format('yyyy-MM-dd'));
		laydate.render({
			elem : '#datepicker',
			  type: 'datetime',
			  range: true
		});
	})
	var _d = '';
	function _getData() {
		acc_x = [],acc_y = [],acc_z =[],x=[],y=[],z=[],ddate =[],tem=[];
		var mac = $('#mac').val();
		var date = $('#datepicker').val();
		var tem_ = $('#tem').val();
		var type = $('#type').val();
		if(date==null||date==''){
			layer.alert('请选择日期！');
		}else{
			var map = [];
			$.ajax({
				url : '/home/cloud/qj/datas',
				dataType : 'json',
				data:'mac='+mac+'&date='+date+'&tem='+tem_,
				type : 'post',
				success : function(res) {
					if(res!=null&&res!=''&&res.data!=null){
						for(var i = res.data.length-1;i>=0;i--){
							res.data[i].createTime = jsDateTime(res.data[i].createTime);
							if(res.data[i].baseX!=''&&res.data[i].baseAcceX!=''&&res.data[i].baseX!=null){
								if(type==1){
									if(res.data[i].rssi!=null&&res.data[i].rssi!=''){
										acc_x.push(parseFloat(res.data[i].baseAcceX).toFixed(4));
										acc_y.push(parseFloat(res.data[i].baseAcceY).toFixed(4));
										acc_z.push(parseFloat(res.data[i].baseAcceZ).toFixed(4));
										x.push(parseFloat(res.data[i].baseX).toFixed(4));
										y.push(parseFloat(res.data[i].baseY).toFixed(4));
										z.push(parseFloat(res.data[i].baseZ).toFixed(4));
										tem.push(parseInt(res.data[i].tem)/1000);
										ddate.push(res.data[i].createTime)
									}
								}else if(type==2){
									if(res.data[i].xtype!=null&&''!=res.data[i].xtype){
										acc_x.push(parseFloat(res.data[i].baseAcceX).toFixed(4));
										acc_y.push(parseFloat(res.data[i].baseAcceY).toFixed(4));
										acc_z.push(parseFloat(res.data[i].baseAcceZ).toFixed(4));
										x.push(parseFloat(res.data[i].baseX).toFixed(4));
										y.push(parseFloat(res.data[i].baseY).toFixed(4));
										z.push(parseFloat(res.data[i].baseZ).toFixed(4));
										tem.push(parseInt(res.data[i].tem)/1000);
										ddate.push(res.data[i].createTime)
									}
								}else{
									acc_x.push(parseFloat(res.data[i].baseAcceX).toFixed(4));
									acc_y.push(parseFloat(res.data[i].baseAcceY).toFixed(4));
									acc_z.push(parseFloat(res.data[i].baseAcceZ).toFixed(4));
									x.push(parseFloat(res.data[i].baseX).toFixed(4));
									y.push(parseFloat(res.data[i].baseY).toFixed(4));
									z.push(parseFloat(res.data[i].baseZ).toFixed(4));
									tem.push(parseInt(res.data[i].tem)/1000);
									ddate.push(res.data[i].createTime)
								}
							}
						}
						_draw();
					}else{
						layer.alert('无相关数据！');
					}
				}
			})
		}
	}
	function _draw(){
		var myChart_1 = echarts.init(document.getElementById('draw_1'),'dark');
		var colors = ['#5793f3', '#d14a61', '#675bba','#1193f3', '#224a61', '#335bba','#FFF'];
		option = {
			    title: {
			        text: 'Step Line'
			    },
			    tooltip: {
			        trigger: 'axis'
			    },
			    legend: {
			        data:['x', 'y', 'z','加速度x','加速度y','加速度z','温度']
			    },
			    grid: {
			        left: '3%',
			        right: '4%',
			        bottom: '3%',
			        containLabel: true
			    },
			    toolbox: {
			        feature: {
			            saveAsImage: {}
			        }
			    },
			    xAxis: {
			        type: 'category',
			        data: ddate
			    },
			    yAxis: {
			        type: 'value'
			    },
			    series: [
			        {
			            name:'x',
			            type:'line',
			            data:x
			        },
			        {
			            name:'y',
			            type:'line',
			            data:y
			        },
			        {
			            name:'z',
			            type:'line',
			            data:z
			        },
			        {
			            name:'加速度x',
			            type:'line',
			            data:acc_x
			        },
			        {
			            name:'加速度y',
			            type:'line',
			            data:acc_y
			        },
			        {
			            name:'加速度z',
			            type:'line',
			            data:acc_z
			        },
			        {
			            name:'温度',
			            type:'line',
			            data:tem
			        }
			    ]
			};
		 myChart_1.setOption(option, true);
	}
	Date.prototype.Format = function(fmt) { 
		var o = {
			"M+" : this.getMonth() + 1, // 月份
			"d+" : this.getDate(), // 日
			"h+" : this.getHours(), // 小时
			"m+" : this.getMinutes(), // 分
			"s+" : this.getSeconds(), // 秒
			"q+" : Math.floor((this.getMonth() + 3) / 3), // 季度
			"S" : this.getMilliseconds()
		// 毫秒
		};
		if (/(y+)/.test(fmt))
			fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "")
					.substr(4 - RegExp.$1.length));
		for ( var k in o)
			if (new RegExp("(" + k + ")").test(fmt))
				fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k])
						: (("00" + o[k]).substr(("" + o[k]).length)));
		return fmt;
	};
</script>

</html>