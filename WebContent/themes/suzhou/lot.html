<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>车位数据</title>
<link
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="/themes/awe/plugins/datepicker/datepicker3.css">
<style type="text/css">
.cursor {
	cursor: pointer;
}

.float-right {
	float: right;
}

.box.box-primary {
	border-top-color: #f4f4f4;
}

.box-header>.fa, .box-header>.glyphicon, .box-header>.ion, .box-header .box-title
	{
	font-size: 15px;
}

.none {
	display: none;
}

.center {
	text-align: center;
}

.width-10 {
	width: 110px;
}

.morris-hover.morris-default-style {
	padding: 6px;
	color: #666;
	font-size: 12px;
	font-weight: 600;
	text-align: center;
	background: rgba(255, 255, 255, 0.8);
	border: solid 2px rgba(230, 230, 230, 0.8);
	-webkit-border-radius: 10px;
	-webkit-background-clip: padding-box;
	-moz-border-radius: 10px;
	-moz-background-clip: padding;
	border-radius: 10px;
	background-clip: padding-box;
	line-height: 25px;
}

.morris-hover {
	position: absolute;
	z-index: 1000;
}

.morris-hover.morris-default-style .morris-hover-row-label {
	margin: .25em 0;
	font-weight: 600;
}

._pic {
	width: 810px;
	height: 400px;
	margin-top: 80px;
	margin-left: 15px;
}

._pic-1 {
	width: 410px;
	height: 400px;
	margin-top: 80px;
	margin-left: 15px;
}
</style>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
					aria-expanded="false">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" target="_blank"
					href="http://www.zhanway.com"><img height="50px;"
					style="margin-top: -15px;" src="img/logo.png"></a>
			</div>
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="active"><a href="lot.html">车位数据</a></li>
					<li><a href="location.html">地理位置</a></li>
					<li><a href="device.html">设备信息</a></li>
					<li><a href="count.html">停车统计</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a target="_blank" href="http://www.zhanway.com">走进展为</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="row" style="width: 98%; margin-left: 1%;">
		<div class="col-md-12">
			<div class="form-group" style="width: 500px;">
				<div class="btn-group">
					<button type="button" data-ref="0" class="btn btn-info _b">天</button>
					<button type="button" data-ref="1" class="btn btn-default _b">周</button>
					<button type="button" data-ref="2" class="btn btn-default _b">月</button>
					<button type="button" data-ref="3" class="btn btn-default _b">年</button>
					<div class="input-group" style="padding-left: 15px;width: 300px;">
				      <input type="text" class="form-control" readonly="readonly" id="datepicker" >
				      <span class="input-group-btn">
				        <button class="btn btn-default" onclick="getData();" type="button">&nbsp;确&nbsp;定&nbsp;</button>
				      </span>
				    </div>
				</div>
			</div>
			<div id="area-chart" style="height: 250px;margin-top: 100px;"></div>
		</div>
	</div>
	<footer class="main-footer"
		style="position: absolute; bottom: 10px; text-align: center; width: 100%;">
		<strong>Copyright &copy; 2014-2026 <a
			href="http://www.zhanway.com" target="_blank">上海展为智能技术股份有限公司</a>.
		</strong> All rights reserved.
	</footer>
	<div class="control-sidebar-bg"></div>
	<script src="https://cdn.bootcss.com/jquery/1.12.0/jquery.min.js"></script>
	<script
		src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.bootcss.com/vue/2.4.4/vue.min.js"></script>
	<script src="/themes/awe/plugins/datepicker/bootstrap-datepicker.js"></script>
	<script src="https://cdn.bootcss.com/echarts/2.2.7/echarts-all.js"></script>
	<script src="https://cdn.bootcss.com/layer/3.0.3/layer.min.js"></script>
	<script src="https://cdn.bootcss.com/raphael/2.1.0/raphael-min.js"></script>
	<script src="https://cdn.bootcss.com/morris.js/0.5.0/morris.min.js"></script>
	<script type="text/javascript">
		Date.prototype.Format = function(fmt) { //author: meizz
			var o = {
				"M+" : this.getMonth() + 1, //月份
				"d+" : this.getDate(), //日
				"h+" : this.getHours(), //小时
				"m+" : this.getMinutes(), //分
				"s+" : this.getSeconds(), //秒
				"q+" : Math.floor((this.getMonth() + 3) / 3), //季度
				"S" : this.getMilliseconds()
			//毫秒
			};
			if (/(y+)/.test(fmt))
				fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "")
						.substr(4 - RegExp.$1.length));
			for ( var k in o)
				if (new RegExp("(" + k + ")").test(fmt))
					fmt = fmt.replace(RegExp.$1,
							(RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k])
									.substr(("" + o[k]).length)));
			return fmt;
		};
		$(function() {
			$('#datepicker').datepicker({
				autoclose : true,
				format : 'yyyy-mm-dd',
				lang : 'ch'
			});
			$("#datepicker").val(new Date().Format("yyyy-MM-dd"));
			$('._b').bind('click', function() {
				var _d = $(this).attr('data-ref');
				$('._b').removeClass('btn-info');
				$('._b').addClass('btn-default');
				$(this).addClass('btn-info');
				app.type = _d;
				getData();
			})
			getData();
		})

		var app = app || {};
		app.type = 0;
		window.app = app;
		app.chartColors = [ '#D3ECF8', '#f0ad4e', '#444', '#888', '#555',
				'#999', '#bbb', '#ccc', '#eee' ];
		var _i = -1;
		function getData() {
			var date = $('#datepicker').val();
			var params = 'locationId=4&op=' + app.type + '&dateStr=' + date;
			$.ajax({
				url : '/interface/suzhou/locationStatus',
				type : 'post',
				dataType : 'json',
				data : params,
				success : function(res) {
					if ('200' == res.code) {
						if (res.data != null) {
							window.app.bufferedData = handle(app.type, date,
									res.data);
							draw();
							$(window).resize(app.debounce(draw, 250));
						} else {
							layer.alert('暂无数据！');
						}
					} else if ('8001' == res.code) {
						layer.alert('您无权限操作此项！');
					} else {
						layer.msg('以下测试数据');
						res = {
							"code" : "200",
							"msg" : "请求成功",
							"data" : [ {
								"period" : "06",
								"利用率" : "3.0"
							}, {
								"period" : "07",
								"利用率" : "5.0"
							}, {
								"period" : "08",
								"利用率" : "8.0"
							}, {
								"period" : "09",
								"利用率" : "24.0"
							}, {
								"period" : "10",
								"利用率" : "62.0"
							}, {
								"period" : "11",
								"利用率" : "76.0"
							}, {
								"period" : "12",
								"利用率" : "75.0"
							}, {
								"period" : "13",
								"利用率" : "77.0"
							}, {
								"period" : "14",
								"利用率" : "78.0"
							}, {
								"period" : "15",
								"利用率" : "74.0"
							}, {
								"period" : "16",
								"利用率" : "71.0"
							}, {
								"period" : "17",
								"利用率" : "60.0"
							}, {
								"period" : "18",
								"利用率" : "37.0"
							}, {
								"period" : "19",
								"利用率" : "21.0"
							}, {
								"period" : "20",
								"利用率" : "14.0"
							}, {
								"period" : "21",
								"利用率" : "8.0"
							}, {
								"period" : "22",
								"利用率" : "5.0"
							} ]
						};
						window.app.bufferedData = handle(app.type, date,
								res.data);
						draw();
						$(window).resize(app.debounce(draw, 250));
						//				layer.alert(res.msg);
					}
				}
			})
		}

		function handle(op, date, params) {
			var hourMock = [];
			if (op == 0) {
				for (var i = 1; i <= 24; i++) {
					var unit = {
						period : i,
						"利用率" : 0
					};
					for (idx in params) {
						if (i == params[idx].period) {
							unit = params[idx];
							break;
						}
					}
					hourMock.push(unit);
				}
			} else if (op == 1) {
				var array = new Array();
				for (i = 7; i >= 1; i--) {
					var d = addDate(date, -i);
					array.push(d);
				}
				array.push(date);
				for (var i = 0; i < array.length; i++) {
					var unit = {
						period : array[i],
						"利用率" : 0
					};
					for ( var idx in params) {
						if (array[i] == params[idx].period) {
							unit = params[idx];
							break;
						}
					}
					hourMock.push(unit);
				}
			} else if (op == 2) {
				var array = new Array();
				var startDate = addMonth(date, -1);
				while (startDate != date) {
					array.push(startDate);
					startDate = addDate(startDate, 1);
				}
				array.push(date);
				for (var i = 0; i < array.length; i++) {
					var unit = {
						period : array[i],
						"利用率" : 0
					};
					for ( var idx in params) {
						if (array[i] == params[idx].period) {
							unit = params[idx];
							break;
						}
					}
					hourMock.push(unit);
				}
			} else if (op == 3) {
				var array = new Array();
				var startDate = addYear(date, -1);
				date = new Date(Date.parse(date.replace(/-/g, "/")))
						.Format("yyyy-MM");
				while (startDate != date) {
					array.push(startDate);
					startDate = addMonthYM(startDate, 1);
				}
				array.push(date);
				for (var i = 0; i < array.length; i++) {
					var unit = {
						period : array[i],
						"利用率" : 0
					};
					for ( var idx in params) {
						if (array[i] == params[idx].period) {
							unit = params[idx];
							break;
						}
					}
					hourMock.push(unit);
				}
			}
			return hourMock;
		}

		function draw() {
			$('#area-chart').empty();
			Morris.Area({
				element : 'area-chart',
				data : window.app.bufferedData,
				xkey : 'period',
				ykeys : [ '利用率' ],
				labels : [ '利用率' ],
				pointSize : 3,
				ymax : 100,
				ymin : 0,
				parseTime : false,
				hideHover : 'auto',
				postUnits : '%',
				lineColors : [ app.chartColors[0] ],
				xLabelFormat : function(x) {
					if (0 == app.type) {
						return x.label + ":00";
					} else {
						return x.label;
					}
				}
			});
		}

		app.debounce = function(func, wait, immediate) {
			var timeout, args, context, timestamp, result;
			return function() {
				context = this;
				args = arguments;
				timestamp = new Date();
				var later = function() {
					var last = (new Date()) - timestamp;
					if (last < wait) {
						timeout = setTimeout(later, wait - last);
					} else {
						timeout = null;
						if (!immediate)
							result = func.apply(context, args);
					}
				};
				var callNow = immediate && !timeout;
				if (!timeout) {
					timeout = setTimeout(later, wait);
				}
				if (callNow)
					result = func.apply(context, args);
				return result;
			};
		}

		function addDate(date, days) {
			var d = new Date(Date.parse(date.replace(/-/g, "/")));
			d.setDate(d.getDate() + days);
			var m = d.getMonth() + 1;
			return new Date(d.getFullYear() + '/' + m + '/' + d.getDate())
					.Format("yyyy-MM-dd");
		}

		function addMonth(date, month) {
			var d = new Date(Date.parse(date.replace(/-/g, "/")));
			var m = d.getMonth() + month;
			d.setMonth(m);
			m = d.getMonth() + 1;
			return new Date(d.getFullYear() + '/' + m + '/' + d.getDate())
					.Format("yyyy-MM-dd");
		}
		function addMonthYM(date, month) {
			date += "-01";
			var d = new Date(Date.parse(date.replace(/-/g, "/")));
			var m = d.getMonth() + month;
			d.setMonth(m);
			m = d.getMonth() + 1;
			return new Date(d.getFullYear() + '/' + m + '/' + d.getDate())
					.Format("yyyy-MM");
		}
		function addYear(date, year) {
			var d = new Date(Date.parse(date.replace(/-/g, "/")));
			var m = d.getMonth() + 1;
			var y = d.getFullYear() + year;
			d.setFullYear(y);
			return new Date(d.getFullYear() + '/' + m + '/' + d.getDate())
					.Format("yyyy-MM");
		}
	</script>
</body>
</html>