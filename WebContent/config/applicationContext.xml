<?xml version="1.0" encoding="UTF-8"?>  
<beans xmlns="http://www.springframework.org/schema/beans"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:p="http://www.springframework.org/schema/p" 
    xmlns:context="http://www.springframework.org/schema/context" 
    xmlns:tx="http://www.springframework.org/schema/tx"  
    xmlns:task="http://www.springframework.org/schema/task" 
    xmlns:aop="http://www.springframework.org/schema/aop" 
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
    					http://www.springframework.org/schema/beans/spring-beans-3.2.xsd  
    					http://www.springframework.org/schema/context  
    					http://www.springframework.org/schema/context/spring-context-3.2.xsd  
    					http://www.springframework.org/schema/aop 
    					http://www.springframework.org/schema/aop/spring-aop-3.0.xsd 
    					http://www.springframework.org/schema/tx 
    					http://www.springframework.org/schema/tx/spring-tx-3.2.xsd 
    					http://www.springframework.org/schema/task 
    					http://www.springframework.org/schema/task/spring-task-3.0.xsd"
    					default-lazy-init="false"> 
    
	<tx:annotation-driven transaction-manager="transactionManager" /> 
    <task:annotation-driven scheduler="qbScheduler" mode="proxy"/>
    <task:scheduler id="qbScheduler" pool-size="10"/> <!-- @Scheduled -->
    
    <bean id="contextApplicationContextProvider" class="common.helper.ApplicationContextProvider"></bean>
    
    <bean class="org.springframework.context.annotation.CommonAnnotationBeanPostProcessor" />
     	
	<bean id="nbDataSourcePlaceHolder" class="common.helper.nbDataSourcePlaceHolder">
        <property name="locations">
            <list>      
                <value>/config/mysql.properties</value><!-- 加密后文件 -->
            </list>
        </property>
        <property name="fileEncoding" value="utf-8"/> 
    </bean>
    
 	<import resource="redis-context.xml"/> 
 	
 	<bean id="nbTransactionInterceptor" class="common.helper.nbTransactionInterceptor"/>
	<!-- freemarker html视图渲染器 -->
	<bean id="freemarkerConfig"
          class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
        <property name="templateLoaderPath" value="/WEB-INF/views/" />
        <property name="freemarkerSettings">
            <props>
                <prop key="template_update_delay">0</prop>
                <prop key="default_encoding">UTF-8</prop>
                <prop key="number_format">0.##########</prop>
                <prop key="datetime_format">yyyy-MM-dd HH:mm:ss</prop>
                <prop key="classic_compatible">true</prop>
                <prop key="template_exception_handler">ignore</prop>
            </props>
        </property>
    </bean>
    <!-- dataSource -->
  	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
	    <property name="driverClassName" value="${jdbc.driverClassName}" />  
	       <property name="url" value="${jdbc.url}" />  
	    <property name="username" value="${jdbc.username}" />  
        <property name="password" value="${jdbc.password}" />
         <property name="defaultAutoCommit" value="true" />
	</bean>  
	<!-- jpa -->
	<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">  
        <property name="dataSource" ref="dataSource"/>
        <property name="packagesToScan" value="database.*" />
        <property name="jpaVendorAdapter">  
              <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"/>
        </property>  
        <property name="jpaProperties">
          	<map>
				<entry key="hibernate.dialect" value="org.hibernate.dialect.MySQLDialect" />
				<entry key="hibernate.show_sql" value="false"/>
				<entry key="hibernate.hbm2ddl.auto" value="update"/>
				<entry key="hibernate.format_sql" value="true"/>
				<entry key="hibernate.ejb.interceptor" value-ref="nbTransactionInterceptor"/>
			</map>
		</property> 
     </bean>   
	  
	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager" >  
        <property name="entityManagerFactory" ref="entityManagerFactory"></property>
    </bean>
    
</beans>