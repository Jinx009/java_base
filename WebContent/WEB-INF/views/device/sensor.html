<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>展为智能</title>
<meta name="viewport"
	content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<link rel="shortcut icon" href="/themes/img/favicon.ico" type="image/x-icon" />  
<link rel="stylesheet" href="/themes/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="/themes/awe/dist/css/AdminLTE.min.css">
<link rel="stylesheet"
	href="/themes/awe/dist/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="/themes/css/home/main.css?_v=1">
<!--[if lt IE 9]>
    	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<body class="hold-transition skin-blue fixed sidebar-mini">
	<!-- Site wrapper -->
	<div class="wrapper">
		<#include "_nav.html">
		<!-- 路径导航 -->
		<div class="content-wrapper" style="background-color: white;">
			<section class="content-header" style="height: 50px;">
				<h1></h1>
				<ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i> Sensor管理 </a></li>
				</ol>
			</section>
			<!-- 主内容 -->
			<section class="content" id="datas">
				<div class="box box-default">
					<div class="box-header with-border">
						<h3 class="box-title">筛选条件</h3>
						<div class="box-tools pull-right">
							<button type="button" class="btn btn-box-tool"
								data-widget="collapse">
								<i class="fa fa-minus"></i>
							</button>
						</div>
					</div>
					<div class="box-body">
						<div class="row">
							<div class="col-md-3">
								<div class="form-group">
									<label>Mac</label> 
									<input type="text" id="mac" class="form-control" placeholder="请输入查询关键词" >
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>Location</label> <select id="location"
										class="form-control select2 select2-hidden-accessible" onchange="_getArea();"
										style="width: 100%;" tabindex="-1" aria-hidden="true">
										<option v-for="item in locations" v-bind:value="item.id" v-text="item.name" ></option>
									</select>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>Area</label> <select id="area"
										class="form-control select2 select2-hidden-accessible"
										style="width: 100%;" tabindex="-1" aria-hidden="true">
										<option v-for="item in areas" v-bind:value="item.id" v-text="item.name" ></option>
									</select>
								</div>
							</div>
								<div class="col-md-3">
								<div class="form-group">
									<label>操作</label> 
									<input type="button" class="btn btn-default btn-xs form-control" onclick="_getData(0,1)" value="查询" >
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Sensor列表</h3>
							</div>
							<!-- /.box-header -->
							<div class="box-body table-responsive no-padding">
								<table class="table table-hover table-bordered">
									<thead>
										<tr>
											<th>编号</th>
											<th>MAC</th>
											<th>电压</th>
											<th>车位号</th>
											<th>ParentMac</th>
											<th>RouterMac</th>
											<th>Area</th>
											<th>RFID</th>
											<th>有车</th>
											<th>上次通信时间</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="item in datas.list">
											<td v-text="item.id"></td>
											<td style="color: blue;" v-text="item.mac" class="mac" v-bind:uid="item.lotNo" v-bind:mac="item.mac" onclick="showLog(this)" ></td>
											<td v-text="item.batteryVoltage"></td>
											<td v-text="item.desc"></td>
											<td v-text="item.parentMac"></td>
											<td v-text="item.routerMac"></td>
											<td v-text="item.areaName"></td>
											<td v-text="item.bluetooth"></td>
											<td>
												<a v-if="1===item.available"
													class='btn btn-success btn-xs' v-text="'有'" ></a>
												<a v-if="0===item.available"
													class='btn btn-danger btn-xs'  v-text="'无'"  ></a>
											</td>
											<td v-text="item.lastSeenTime"></td>
											<td>
												<button class='btn btn-info btn-xs' v-bind:id="'_d'+item.mac" onclick="_goDetail(this);" v-text="'详情'" ></button>
												<button class='btn btn-info btn-xs' v-bind:id="'_j'+item.mac" onclick="_goJob(this);"  v-text="'运行指令'"  ></button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="box-footer clearfix"
								style="width: 320px; float: right;">
								<div class="input-group">
									<span class="input-group-addon" onclick="_getData(0,1);">«</span>
									<span class="input-group-addon" onclick="_getData(1,0);">‹</span>
									<input type="text" style="text-align: center;"
										onfocus="_getNowPage(this)" onblur="_getAllPage(this)"
										v-bind:value="'当前第'+datas.page.currentPage+'页，共'+datas.page.pages+'页'"
										class="form-control"> <span class="input-group-addon"
										onclick="_getData(1,1);">›</span> <span
										class="input-group-addon" id="_end">»</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<#include "_footer.html">
	</div>
	<script src="/themes/js/home/device/sensor.js?version=1.25"></script>
	<script type="text/javascript">
	function showLog(_e){
		var mac = $(_e).attr('mac');
		var myDate = new Date();
		var _day = myDate.getDate();
		_day = parseInt(_day);
		if(_day<10){
			_day = '0'+_day;
		}
		var _month = myDate.getMonth(); 
		_month = parseInt(_month)+1;
		if(_month<10){
			_month = '0'+_month;
		}
		var _uid = $(_e).attr('uid');
		if(_uid==1){
			window.open('http://139.196.205.157/nb/heart_log/heart_log_'+_month+_day+'_'+mac+'.txt');
		}else if(_uid==2){
			window.open('http://139.196.205.157/nb/nb_coap/heart_log/heart_log_'+_month+_day+'_'+mac+'.txt');
		}else if(_uid==3){
			window.open('http://139.196.205.157/claa/heart_log/heart_log_'+_month+_day+'_'+mac+'.txt');
		}else{
			layer.alert('传统地磁不支持在线查看心跳！');
		}
		
		/* window.open('http://39.108.12.220:801/heart_log/heart_log_'+_month+_day+'_'+mac+'.txt'); */
	}
	</script>
</body>
</html>