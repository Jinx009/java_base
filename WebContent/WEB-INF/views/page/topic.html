 <#include "gnss_header.html">
		<div class="page-content-wrapper">
			<div class="page-content">
				<div class="page-bar">
					<ul class="page-breadcrumb">
						<li><i class="fa fa-home"></i> <a href="">主题管理</a>
							<i class="fa fa-angle-right"></i></li>
					</ul>
				</div>
				<div class="row" style="margin-top: 15px;">
					<div class="col-md-6">
						<form class="form-horizontal" role="form">
								<div class="form-group">
									<label for="inputEmail1" class="col-md-2 control-label">MAC</label>
									<div class="col-md-4">
										<input type="text" class="form-control" id="mac" placeholder="mac">
									</div>
								</div>
								<div class="form-group">
									<label for="inputPassword12" class="col-md-2 control-label">主题</label>
									<div class="col-md-4">
										<input type="text" class="form-control" id="topic" >
									</div>
								</div>
								<div class="form-group">
									<div class="col-md-offset-2 col-md-10">
										<button type="button" onclick="save()" class="btn blue">下发订阅</button>
									</div>
								</div>
							</form>
					</div>
				</div>
				<div class="row" style="margin-top: 15px;">
					<div class="col-md-12 col-sm-12">
						<div class="portlet light bordered">
							<div class="portlet-title">
								<div class="caption">
									<i class="icon-share font-blue-steel"></i> <span
										class="caption-subject font-blue-steel ">订阅主题管理</span>
								</div>
							</div>
							<div class="portlet-body">
								<div class="slimScrollDiv"
									style="position: relative;width: auto;" id="data">
									<div class="table-scrollable">
										<table class="table table-striped table-bordered table-hover">
											<thead>
												<tr>
													<th scope="col">mac</th>
													<th scope="col">主题</th>
													<th scope="col">创建时间</th>
													<th scope="col">操作</th>
												</tr>
											</thead>
											<tbody>
												<tr v-for="item in datas.list">
													<td v-text="item.mac"></td>
													<td v-text="item.topic"></td>
													<td v-text="item.createTime"></td>
													<td><a class="edit" style="display:none;" v-bind:id="item.id" onclick="_edit(this)" v-text="'取消订阅'" ></a></td>
												</tr>
											</tbody>
										</table>
									</div>
									 <div class="row">
                                <div class="col-md-9 col-sm-12"></div>
                                <div class="col-md-3 col-sm-12">
                                    <div class="dataTables_paginate paging_simple_numbers"
                                         id="sample_editable_1_paginate">
                                        <ul class="pagination">
                                            <li class="paginate_button previous "
                                                aria-controls="sample_editable_1" tabindex="0"
                                                id="sample_editable_1_previous">
                                                <a href="#" onclick="_sub()">
                                                    <i class="fa fa-angle-left"></i>
                                                </a>
                                            </li>
                                            <li class="paginate_button active" aria-controls="sample_editable_1"
                                                tabindex="0">
                                                	 <a href="#" v-text="'当前第'+datas.page.currentPage+'页;共'+datas.page.pages+'页'" ></a>
                                            </li>
                                            <li class="paginate_button next "
                                                aria-controls="sample_editable_1" tabindex="0"
                                                id="sample_editable_1_next">
                                                <a href="#" onclick="_add()">
                                                    <i class="fa fa-angle-right"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	 <#include "gnss_footer.html">
<script>
$(function(){
	_setClass();
	_getData();
	var mac = getUrlParam('mac');
	if(mac!=null&&mac!=''){
		$('#mac').val(mac);
	}
})
function save(){
	var mac = $('#mac').val();
	var topic = $('#topic').val();
	var params = 'mac='+mac+'&topic='+topic;
	$.ajax({
		url:'/d/gnssrtktopic/save',
		data:params,
		dataType:'json',
		type:'post',
		success:function(res){
			if('200'==res.code){
				layer.alert('下发成功！',function(){
					location.reload();
				})
			}else{
				layer.alert(res.msg);
			}
		}
	})
}
function _edit(_e){
	var id = $(_e).attr('id');
	$.ajax({
		url:'/d/gnssrtktopic/del?id='+id,
		dataType:'json',
		type:'post',
		success:function(res){
			if('200'==res.code){
				layer.alert('操作成功！',function(){
					location.reload();
				})
			}else{
				layer.alert(res.msg);
			}
		}
	})
}
var mac = '';
var p = 1;
var max = 1;
var _d = '';
function _getData(){
	if(mac!=$('#mac').val()){
		p = 1;max = 1;
		mac = $('#mac').val();
	}
	$.ajax({
		url:'/d/gnssrtktopic/list?mac='+mac+'&p='+p,
		dataType:'json',
		type:'post',
		success:function(res){
			max = res.data.page.pages;
			if(res.data!=null&&res.data.list.length>0){
				for(var i in res.data.list){
					res.data.list[i].createTime = toDateTime(parseInt(res.data.list[i].createTime));
				}
				$('.edit').show();
				if(_d==''){
	  				_d = new Vue({
	  					el : '#data',
	  					data : {
	  						datas : res.data
	  					}
	  				})
	  			}else{
	  				_d.datas = res.data
	  			}
			}
		}
	})
}
function _add(){
	if(max==p){
		layer.alert('当前已是最后一页！');
	}else{
		p++;
		_getData();
	}
}
function _sub(){
	if(p==1){
		layer.alert('已经是起始页！');
	}else{
		p--;
		_getData();
	}
}
</script>
</body>
</html>