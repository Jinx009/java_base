<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>展为智能</title>
<meta name="viewport"
	content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<link rel="shortcut icon" href="/themes/img/favicon.ico"
	type="image/x-icon" />
<link rel="stylesheet" href="/themes/dist/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="/themes/awe/dist/css/AdminLTE.min.css">
<link rel="stylesheet"
	href="/themes/awe/dist/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="/themes/css/home/main.css?_v=1">
<!--[if lt IE 9]>
    	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<body class="hold-transition skin-blue fixed sidebar-mini">
	<!-- Site wrapper -->
	<div class="wrapper">
		<#include "home_nav.html"> <!-- 路径导航 -->
		<div class="content-wrapper" style="background-color: white;">
			<section class="content-header" style="height: 50px;">
				<h1></h1>
				<ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i> tcp管理 </a></li>
				</ol>
			</section>
			<!-- 主内容 -->
			<section class="content" id="datas">
				<div class="box box-default">
					<div class="box-header with-border">
						<h3 class="box-title">新增</h3>
						<div class="box-tools pull-right">
							<button type="button" class="btn btn-box-tool"
								data-widget="collapse">
								<i class="fa fa-minus"></i>
							</button>
						</div>
					</div>
					<div class="box-body">
						<div class="row">
							<div class="col-md-3">
								<div class="form-group">
									<label>启动端口</label> <input type="text" id="serverPort"
										class="form-control" placeholder="请输入启动端口">
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>FixType</label> <select class="form-control"
										id="autoSend">
										<option value="true">主动发心跳</option>
										<option value="false">不主动发心跳</option>
									</select>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>下发数据来源端口</label> <input type="text" id="dataFromServer"
										class="form-control" placeholder="下发数据来源端口">
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<button class="btn btn-default" onclick="_newServer();"
										type="button">新增server</button>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-3">
								<div class="form-group">
									<label>转发ip</label> <input type="text" id="clinetIp"
										class="form-control" placeholder="请输入转发ip">
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>转发端口</label> <input type="text" id="clinetPort"
										class="form-control" placeholder="请输入转发端口">
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label>数据来源server端口</label> <input type="text" id="port"
										class="form-control" placeholder="数据来源server端口">
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<button class="btn btn-default" onclick="_newClient();"
										type="button">新增client</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-12">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">tcp管理</h3>
							</div>
							<!-- /.box-header -->
							<div class="box-body table-responsive no-padding">
								<table class="table table-hover table-bordered">
									<thead>
										<tr>
											<th>类型</th>
											<th>数据来源端口</th>
											<th>是否主动发送心跳</th>
											<th>转发端口</th>
											<th>转发ip</th>
											<th>自身端口</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody id="data">
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<#include "home_footer.html">
	</div>
	<script type="text/javascript">
		$(function() {
			$.ajax({
				url : '/netty/list',
				type : 'get',
				dataType : 'json',
				success : (function(res) {
					if (res.data != null) {
						var htmlStr = '';
						if (res.data.server != null) {
							for ( var i in res.data.server) {
								var server = res.data.server[i];
								htmlStr += '<tr><td>server</td><td>'
										+ server.dataFrom + '</td><td>'
										+ server.autoSend
										+ '</td><td></td><td></td><td>' + server.port
										+ '</td><td><a class="btn btn-info" onclick="_closeServer('+server.port+')">删除</a></tr>';
							}
						}
						if (res.data.client != null) {
							for ( var i in res.data.client) {
								var client = res.data.client[i];
								htmlStr += '<tr><td>client</td><td>'
										+ client.dataFrom
										+ '</td><td></td><td>' + client.port
										+ '</td><td>' + client.ip
										+ '</td><td></td><td><a class="btn btn-info" onclick="_closeClient('+client.dataFrom+')">删除</a></td></tr>';
							}
						}
						$('#data').html(htmlStr);
					}
				})
			})
		})
		function _newClient() {
			var port = $('#port').val(), clientPort = $('#clinetPort').val(), clientIp = $(
					'#clinetIp').val();
			$.ajax({
				url : '/netty/client?port=' + clientPort + '&ip=' + clientIp
						+ '&dataFrom=' + port,
				type : 'get',
				dataType : 'json',
				success : function(res) {
					if (res.code = '200') {
						layer.alert('新增成功！', function() {
							location.reload();
						})
					}
				}
			})
		}
		function _newServer() {
			var autoSend = $('#autoSend').val(), dataFromServer = $(
					'#dataFromServer').val(), serverPort = $('#serverPort')
					.val();
			$.ajax({
				url : '/netty/server?port=' + serverPort + '&autoSend='
						+ autoSend + '&dataFrom=' + dataFromServer,
				type : 'get',
				dataType : 'json',
				success : function(res) {
					if (res.code = '200') {
						layer.alert('新增成功！', function() {
							location.reload();
						})
					}
				}
			})
		}
		function _closeServer(port){
			$.ajax({
				url:'/netty/closeServer?port='+port,
				type : 'get',
				dataType : 'json',
				success : function(res) {
					if (res.code = '200') {
						layer.alert('删除成功！', function() {
							location.reload();
						})
					}
				}
			})
		}
		function _closeClient(port){
			$.ajax({
				url:'/netty/closeClient?port='+port,
				type : 'get',
				dataType : 'json',
				success : function(res) {
					if (res.code = '200') {
						layer.alert('删除成功！', function() {
							location.reload();
						})
					}
				}
			})
		}
	</script>
</body>
</html>